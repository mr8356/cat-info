<!DOCTYPE html>
<html>
	<head>
		<!-- head ë¶€ë¶„ì— í…ìŠ¤íŠ¸ ì¸ì½”ë”© íƒ€ì… utf-8ë¡œ ì‘ì„± -->
		<meta charset="utf-8" /> 
		<!-- ë¸Œë¼ìš°ì € ìƒë‹¨ íƒ­ì— ì œëª©ìœ¼ë¡œ ë‚˜ì˜´ -->
	<title>íšŒì›ê°€ì… ì‹¤ìŠµ</title>
	<!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		var mytoken = "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImNhdGRkZEBuYXZlci5jb20iLCJzdWIiOiI2MmIwOWEyYWYwNjYzMjA5OGUxYjc4ZjIiLCJpYXQiOjE2NTU3NDE5MzUsImV4cCI6MTY4NzI5OTUzNX0.Ufzi1zSEvF9HIMjXUnqRu2zzpboCpTs-FEC8TKIIFiM";
		var headerParams = {'Authorization' : "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImNhdGRkZEBuYXZlci5jb20iLCJzdWIiOiI2MmIwOWEyYWYwNjYzMjA5OGUxYjc4ZjIiLCJpYXQiOjE2NTU3NDE5MzUsImV4cCI6MTY4NzI5OTUzNX0.Ufzi1zSEvF9HIMjXUnqRu2zzpboCpTs-FEC8TKIIFiM"};
		function check_password(pass){
			var exp = /[@#$]+[a-z]+[A-Z]+[^~`|%^&*\'";:/?]/;
			return exp.test(pass);
		}
		// show í•¨ìˆ˜
		function show() {
			var form = document.myform; //ì…ë ¥ì–‘ì‹ì„ ê°€ì ¸ì˜´.
			var email = form["email"].value;
			var name = form["name"].value;
			var password = form["pass"].value;
			if(email.length==0){
				alert("ì´ë©”ì¼ì€ í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.");
				return false;
			}
			else if(email.length<6){
				alert("ì´ë©”ì¼ì€ 6ìë¦¬ ì´ìƒì…ë‹ˆë‹¤.");
				return false;
			}
			else if(name.length==0){
				alert("ì´ë¦„ì€ í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.");
				return false;
			}
			else if(password.length==0){
				alert("ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.");
				return false;
			}
			else if(password.length<6){
				alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 6ìë¦¬ ì´ìƒì…ë‹ˆë‹¤.");
				return false;
			}
			else if(!(/[0-9]+/).test(password)){
				alert("ë¹„ë°€ë²ˆí˜¸ì— ìˆ«ìê°€ í¬í•¨ë˜ì–´ì•¼í•©ë‹ˆë‹¤.");
				return false;
			}
			else if(!(/[a-zA-Z]+/).test(password)){
				alert("ë¹„ë°€ë²ˆí˜¸ì— ì˜ë¬¸ì´ í¬í•¨ë˜ì–´ì•¼í•©ë‹ˆë‹¤.");
				return false;
			}
			else if((/[~`!%^&*|\'";:/?]+/).test(password)){
				alert("ë¹„ë°€ë²ˆí˜¸ì— íŠ¹ìˆ˜ë¬¸ì ~`|%^&*\\'\";:/?ëŠ” í¬í•¨ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
				return false;
			}
			else {
				var postReq = $.ajax({
					type: "POST",
					url: "/cats",
					data: {
						"email":email,
						"name":name,
						"password":password
					},
					dataType: "JSON",
					success : function(result){
						console.log(result.name);
					}
				});
			}
		}
		function get() {
			var getReq = $.ajax({
					type: "GET",
					url: "/cats",
					headers : headerParams,
					dataType : "JSON"
			});
			getReq.done(function (data) {
				$("#textbox").empty();
				var tb = $("<table/>").css("border" , "1px solid black");
				var row = $("<tr/>").append(
					$("<th/>").text("ì´ë©”ì¼"),
					$("<th/>").text("ì‚¬ì§„"),
					$("<th/>").text("ì´ë¦„"),
				);
				tb.append(row);
				var email= data.email;
				var img = data.imgUrl;
				var name = data.name;
				var r = $("<tr/>").append(
					$("<td/>").text(email),
					$("<td/>").append($("<img/>").attr("src" , img).width(50)),
					$("<td/>").text(name));
				tb.append(r);
				$("#textbox").html(tb);
			});
		}
		function login() {
			var form = document.myform; //ì…ë ¥ì–‘ì‹ì„ ê°€ì ¸ì˜´.
			var email = form["email"].value;
			var password = form["pass"].value;
			var postReq = $.ajax({
					type: "POST",
					url: "/cats/login",
					data: {
						"email":email,
						"password":password
					},
					dataType: "JSON",
					success : function(result){
						console.log(result.token);
						mytoken = result.token;
						headerParams = {'Authorization' : 'bearer '+mytoken};
						get();
					}
				});
		}
		function getAll() {
			$("#textbox").empty();
			var getReq = $.ajax({
					type: "GET",
					url: "/cats/all",
					headers : headerParams,
					dataType : "JSON"
			});
			getReq.done(function (data) {
				var tb = $("<table/>").css("border" , "1px solid black");
				var row = $("<tr/>").append(
					$("<th/>").text("ì´ë©”ì¼"),
					$("<th/>").text("id"),
					$("<th/>").text("ì´ë¦„"),
				);
				tb.append(row);
				for(var i = 0; i<data.length; i++){
					var email= data[i].email;
					var img = data[i].imgUrl;
					var name = data[i].name;
					var r = $("<tr/>").append(
						$("<td/>").text(email),
						$("<td/>").append($("<img/>").attr("src" , img).width(50)),
						$("<td/>").text(name));
					tb.append(r);
				}
				$("#textbox").html(tb);
			});
		}
	</script>
	</head>
	<body>
		<h1>â–¶ï¸ê³ ì–‘ì´ğŸ˜» íšŒì›ê°€ì…<br></h1>
		<form method="post" name="myform">
		<table border="1" bgcolor="white" bordercolor="black">
			<tr>
				<td>* ì´ë©”ì¼:</td>
				<td><input type="text" name="email" maxlength="20" size="30" /></td>
			</tr>
			<tr>
				<td>* ì´ë¦„ :</td>
				<td><input type="text" name="name" maxlength="12" size="15" /></td>
			</tr>
			<tr>
				<td>* ë¹„ë°€ë²ˆí˜¸ :</td>
				<td><input type="password" name="pass" maxlength="30" size="30" /></td>
			</tr>
		<!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‘ì„±í•œ ê²ƒ ì‹¤í–‰ -->
		<br><input type="button" value="íšŒì› ê°€ì…" onclick="show();">
		<br><input type="button" value="ë¶ˆëŸ¬ì˜¤ê¸°" onclick="get();">
		<br><input type="button" value="ë¡œê·¸ì¸" onclick="login();">
		<br><input type="button" value="ê³ ì–‘ì´ë“¤ íƒìƒ‰" onclick="getAll();">
		<input type="reset" value="ë‹¤ì‹œ ì‘ì„±">
	</form>
	<div id="textbox">
		
	</div>
	</body>
</html>